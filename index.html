<!DOCTYPE html>
<html>
    <head>
        <title>MyRevision.net</title>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <link rel='stylesheet' href='/style.css'>

    </head>

    <body>
        <h1>My Revision</h1>
        
        <div id="iscreen" style="display: block;">
            <p> Number of Questions: 
                <input type="text" id="input_box" value="1"></input>
                <button onclick="GetQuestions()">Start</button>
            </p>
        </div>
        
        <div id="qscreen" style="display: none;">
            <h2 id="i"></h2>
            
            <p id="question"></p>
            
            <p>
                <button onclick="ChangeQuestion(1)">Forward</button>
                <button onclick="ChangeQuestion(-1)">Backwards</button>
            </p>
            
            <p>
                <input type="text" id="answer_box" value=""></input>
                <button onclick="SubmitAnswers()" id="submit_button" style="display: none;">Submit Answers</button>
            </p>
        </div>
        
        <div id="ascreen" style="display: none;">
            <p id="correct"><p>
            <br>
            
            <p>You entered this:</p>
            <ol id="userAnswers">
            </ol>
            <br>
            
            <p>The correct answers are:</p>
            <ol id="correctAnswers">
            </ol>
        </div>
            
        <script>
            var currentQuestion = 1;
            var correct = 0;
            var questions = [""];
            var ids = [0];
            var answers = [""];
            var numberofquestions = "";
            const getQuestionAPI = "https://qg7wae0zml.execute-api.eu-west-1.amazonaws.com/live?numberofquestions=";
            const submitAnswersAPI = ""
            
            function ChangeQuestion(changeby) {
                answers[currentQuestion-1] = document.getElementById("answer_box").value;
                currentQuestion = currentQuestion + changeby; 
                
                if (currentQuestion <= questions.length && currentQuestion >= 1)
                {
                    document.getElementById("answer_box").value = answers[currentQuestion-1];
                    document.getElementById("question").innerHTML = questions[currentQuestion-1];
                    document.getElementById("i").innerHTML = "Question " + currentQuestion + "/" + questions.length;
                    
                    if (currentQuestion == questions.length){
                        document.getElementById("submit_button").style.display = "block";
                    }
                    else{
                        document.getElementById("submit_button").style.display = "none";
                    }
                }
                else
                {
                    currentQuestion = currentQuestion - changeby;
                }
            }

            function GetQuestions() {
                InitialiseQuestionScreen();
                
                numberofquestions = document.getElementById("input_box").value;
                var api = getQuestionAPI + numberofquestions;
                console.log(api);
                
                $.getJSON(api, function(data) {
                    for(var i = 0; i < data.questions.length; i++){
                        questions[i] = data.questions[i].Item.question;
                        if(i != 0){
                            answers.push("");
                            ids.push(data.questions[i].Item.id);
                        }
                        else{
                            ids[0] = data.questions[i].Item.id;
                        }
                    }
                    
                    console.log(questions);
                    console.log(ids);
                    console.log(answers);
            
                    document.getElementById("question").innerHTML = questions[currentQuestion-1];
                    document.getElementById("i").innerHTML = "Question " + currentQuestion + "/" + questions.length;
                });
            }
            
            function SubmitAnswers() {
                InitialiseAnswerScreen();
                
                var api = submitAnswersAPI + answers + ids;
                console.log(api);
                
                $.getJSON(api, function(data) {
                    document.getElementById("correct").innerHTML = "You got " + data.correct + "/" +  + " correct.";
                    
                    for(var i = 0; i < answers.length; i++){
                        document.getElementById("userAnswers").append("<li>" + answers[i] + "</li>" );
                    }
                    
                    for(var i = 0; i < data.answers.length; i++){
                        document.getElementById("correctAnswers").append( '<li>' + data.answers[i].Item.answer + '</li>' );
                    }
                });
            }
            
            function InitialiseQuestionScreen(){
                document.getElementById("iscreen").style.display = "none";
                document.getElementById("qscreen").style.display = "block";
            }
            
            function InitialiseAnswerScreen(){
                document.getElementById("qscreen").style.display = "none";
                document.getElementById("ascreen").style.display = "block";
            }
        </script>
    </body>
</html>